<div class="container-fluid py-4">
    <div class="mb-3">
      <a routerLink="/admin-dashboard" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i> Retour au tableau de bord
      </a>
    </div>
  
    <div class="container-fluid py-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Gestion des événements</h2>
        <button class="btn btn-primary" (click)="openAddModal(addModal)">
          <i class="bi bi-plus-circle me-2"></i>Ajouter un événement
        </button>
      </div>
  
      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Chargement...</span>
        </div>
      </div>
  
      <div *ngIf="!isLoading" class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Titre</th>
              <th>Date & Heure</th>
              <th>Espace</th>
              <th>Participants</th>
              <th>Prix</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let event of events">
              <td>{{ event.title }}</td>
              <td>
                <div>{{ event.startTime | frenchDate }}</div>
                <div>à {{ event.endTime | frenchDate }}</div>
              </td>
              <td>
                <span *ngIf="event.space">{{ event.space.name }}</span>
                <span *ngIf="!event.space">Chargement...</span>
              </td>
              <td>
                {{ event.participants?.length || 0 }} / {{ event.maxParticipants }}
              </td>
              <td>{{ event.price | currency:'TND ':'symbol':'1.3' }}</td>
              <td>
                <span class="badge" [ngClass]="{
                  'bg-success': event.isActive,
                  'bg-secondary': !event.isActive
                }">
                  {{ event.isActive ? 'Actif' : 'Inactif' }}
                </span>
              </td>
              <td>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-primary" (click)="openEditModal(editModal, event)">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-outline-danger" (click)="openDeleteModal(deleteModal, event)">
                    <i class="bi bi-trash"></i>
                  </button>
                  <button class="btn btn-outline-secondary" (click)="toggleEventStatus(event)">
                    <i class="bi" [ngClass]="{
                      'bi-toggle-off': !event.isActive,
                      'bi-toggle-on': event.isActive
                    }"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
  
      <!-- Modal : Ajouter un événement -->
      <ng-template #addModal let-modal>
        <div class="modal-header">
          <h5 class="modal-title">Ajouter un nouvel événement</h5>
          <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="eventForm" (ngSubmit)="addEvent()">
            <div class="mb-3">
              <label class="form-label">Titre *</label>
              <input type="text" class="form-control" formControlName="title">
            </div>
  
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" rows="3" formControlName="description"></textarea>
            </div>
  
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Heure de début *</label>
                <input type="datetime-local" class="form-control" formControlName="startTime">
                <small class="text-muted" *ngIf="eventForm.get('startTime')?.value">
                  {{ eventForm.get('startTime')?.value | frenchDate }}
                </small>
              </div>
              <div class="col-md-6">
                <label class="form-label">Heure de fin *</label>
                <input type="datetime-local" class="form-control" formControlName="endTime">
                <small class="text-muted" *ngIf="eventForm.get('endTime')?.value">
                  {{ eventForm.get('endTime')?.value | frenchDate }}
                </small>
              </div>
            </div>
  
            <div class="mb-3">
              <label class="form-label">Espace *</label>
              <select class="form-select" formControlName="spaceId">
                <option *ngFor="let space of spaces" [value]="space.id">{{ space.name }}</option>
              </select>
            </div>
  
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Nombre max de participants *</label>
                <input type="number" class="form-control" formControlName="maxParticipants">
              </div>
              <div class="col-md-6">
                <label class="form-label">Prix</label>
                <input type="number" class="form-control" formControlName="price">
              </div>
            </div>
  
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="isActive" formControlName="isActive">
              <label class="form-check-label" for="isActive">Actif</label>
            </div>
  
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss()">Annuler</button>
              <button type="submit" class="btn btn-primary" [disabled]="eventForm.invalid">
                Ajouter l'événement
              </button>
            </div>
          </form>
        </div>
      </ng-template>
  
      <!-- Modal : Modifier un événement -->
<ng-template #editModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Modifier l'événement</h5>
    <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="eventForm" (ngSubmit)="updateEvent()">
      <div class="mb-3">
        <label class="form-label">Titre *</label>
        <input type="text" class="form-control" formControlName="title">
      </div>

      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea class="form-control" rows="3" formControlName="description"></textarea>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label">Heure de début *</label>
          <input type="datetime-local" class="form-control" formControlName="startTime">
          <small class="text-muted" *ngIf="eventForm.get('startTime')?.value">
            {{ eventForm.get('startTime')?.value | frenchDate }}
          </small>
        </div>
        <div class="col-md-6">
          <label class="form-label">Heure de fin *</label>
          <input type="datetime-local" class="form-control" formControlName="endTime">
          <small class="text-muted" *ngIf="eventForm.get('endTime')?.value">
            {{ eventForm.get('endTime')?.value | frenchDate }}
          </small>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Espace *</label>
        <select class="form-select" formControlName="spaceId">
          <option *ngFor="let space of spaces" [value]="space.id">{{ space.name }}</option>
        </select>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label">Nombre max de participants *</label>
          <input type="number" class="form-control" formControlName="maxParticipants">
        </div>
        <div class="col-md-6">
          <label class="form-label">Prix</label>
          <input type="number" class="form-control" formControlName="price">
        </div>
      </div>

      <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="editIsActive" formControlName="isActive">
        <label class="form-check-label" for="editIsActive">Actif</label>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss()">Annuler</button>
        <button type="submit" class="btn btn-primary" [disabled]="eventForm.invalid">
          Enregistrer les modifications
        </button>
      </div>
    </form>
  </div>
</ng-template>
  
      <!-- Modal : Confirmation de suppression -->
      <ng-template #deleteModal let-modal>
        <div class="modal-header">
          <h5 class="modal-title">Confirmer la suppression</h5>
          <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
        </div>
        <div class="modal-body">
          <p>Êtes-vous sûr de vouloir supprimer l'événement "{{ selectedEvent?.title }}" ? Cette action est irréversible.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss()">Annuler</button>
          <button type="button" class="btn btn-danger" (click)="deleteEvent()">Supprimer</button>
        </div>
      </ng-template>
    </div>
  </div>
  